# 套装调试
## 1 文件介绍
<img src =./resourse/7.png align = "center">

<img src =./resourse/8.png align = "center">

## 2设备连接
### 2.1串口设备
打开设备管理器，将2台机械臂和传送带的串口线按顺序插入电脑，电脑会给设备分配一个串口号，记录好每一台设备的串口号，建议每个设备连接到固定的USB接口上，否则串口号需要重新确认。设备与PC通过串口通信，所有要保证设备与串口号对应上，否则程序不能正常运行。
<img src =./resourse/9.png align = "center">

### 2.2 USB设备
打开设备管理器，设备会给2个USB相机分配一个不同的编号，在程序中通过切换相机编号，从而获取不同相机间采集的图像，建议每个设备连接到固定的USB接口上
**注意事项**
一个USB拓展坞只能接一个USB相机，若将两个相机都接入到同一个USB拓展坞，会导致相机之间的数据流有冲突，导致程序出错
<img src =./resourse/10.png align = "center">

## 3 机械臂回零
打开myblockly,除了串口号根据实际的设备选择，其余按照红框1配置，然后点击回零键，机械臂会进行回零操作，待回零操作结束后，便可对机械臂操作。机械臂重新启动后，都需要进行回零操作
<img src =./resourse/11.png align = "center">

**注意**
<img src =./resourse/12.png align = "center">

## 4 手眼标定
**注意:两台机械臂已经过手眼标定，只需确定相机编号，看实际偏差，根据机械臂基坐标系进行微小调整**
### 4.1 二维码检测
打开Aruco_test.py脚本，确定2个相机的相机编号。笔记本电脑给相机分配的编号为1和2，在变量cam_num切换1和2来确定哪个是拆垛相机和码垛相机
<img src =./resourse/14.png align = "center">

拆垛相机画面
<img src =./resourse/15.png align = "center">

码垛相机画面
<img src =./resourse/16.png align = "center">

### 4.2 标定
运行demo脚本，观察末端吸盘距离木块有多少位移，pump_x为木块对应机械臂基座标系的X方向偏移，pump_y为木块对应机械臂基座标系下的y方向偏移。记录下pump_x和pump_y的值，重新运行程序，观察吸盘能否到达木块中心点，若能到达。则标定结束，标定结束后，不能移动相机和机械臂位置。
<img src =./resourse/sorting_kit/zb.png align = "center">


**码垛相机标定示例**

运行demo.py前确定好每个设备的串口号和相机编号后，填入到对应类的参数上。然后运行程序即可
<img src =./resourse/27.png align = "center">

先用尺子测量吸盘末端和木块中心点在X轴的差值，在本次实验中，X轴的差值为30mm左右。Y轴的差值也是按照同样方法测量
<img src =./resourse/20.jpg align = "center">
Y轴差值为5mm左右
<img src =./resourse/24.jpg align = "center">
最终效果。pump_x和pump_y根据尺子的测量的值进行微调，确保吸盘末端与木块中心点尽量重合
<img src =./resourse/sorting_kit/handeye.png align = "center">
拆垛相机与拆垛机器人的手眼标定也是按照以上步骤进行操作。



## 5 场景联调

运行demo.py前确定好每个设备的串口号和相机编号后，填入到对应类的参数上。然后运行程序即可
<img src =./resourse/27.png align = "center">

确保拆垛区域能完整拍到并识别6个二维码

<img src =./resourse/15.png align = "center">

程序结束后，码垛区域效果

<img src =./resourse/28.jpg align = "center">


场景完整运行视频

<video id="my-video" class="video-js" controls preload="auto" width="100%"
poster="" data-setup='{"aspectRatio":"16:9"}'>
  <source src="https://static.elephantrobotics.com/wp-content/uploads/2023/11/%E5%A5%A5%E5%88%9B%E6%99%BA%E8%83%BD%E5%88%86%E6%A0%8B%E5%A5%97%E8%A3%857.mp4"></video>

## 6 注意事项
程序正常运行后，不要再移动拆垛区域的木块，码垛区域的码垛顺序取决于拆垛区域木块的叠放顺序，因为18个木块上的二维码ID号是唯一的。ID从1-18，码垛机械臂会将木块按照1-3，4-6，7-9，10-12，13-15，16-18，三个木块为一组进行叠放。

---
[← 上一页](./2.3-Software_Building.md) | [下一页 → ](./14-IssueFAQ/14-FAQ.md)